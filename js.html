<script>
document.body.style = "font-family: Arial; margin: 20px; background: #f0f0f0;";

const container = document.createElement("div");
container.style = "max-width: 600px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px #ccc;";
document.body.appendChild(container);

// Ti√™u ƒë·ªÅ
const title = document.createElement("h2");
title.innerText = "C√¥ng c·ª• ki·ªÉm th·ª≠ t·∫£i (JavaScript)";
container.appendChild(title);

// T·∫°o input function
function createField(labelText, inputId, inputType = "text", defaultValue = "") {
  const label = document.createElement("label");
  label.innerText = labelText;
  label.style = "display: block; margin-top: 10px;";
  container.appendChild(label);

  const input = document.createElement("input");
  input.type = inputType;
  input.id = inputId;
  input.value = defaultValue;
  input.style = "padding: 8px; width: 100%; margin-top: 4px;";
  container.appendChild(input);
}

// T·∫°o c√°c tr∆∞·ªùng
createField("üîó URL:", "url", "text", "https://httpbin.org/get");
createField("‚öôÔ∏è S·ªë request/gi√¢y:", "rps", "number", "5");
createField("‚è±Ô∏è Th·ªùi gian ki·ªÉm th·ª≠ (gi√¢y):", "duration", "number", "10");

// Ph∆∞∆°ng th·ª©c
const methodLabel = document.createElement("label");
methodLabel.innerText = "üì° Ph∆∞∆°ng th·ª©c:";
methodLabel.style = "display: block; margin-top: 10px;";
container.appendChild(methodLabel);

const methodSelect = document.createElement("select");
methodSelect.id = "method";
methodSelect.style = "padding: 8px; width: 100%; margin-top: 4px;";
["GET", "POST"].forEach(method => {
  const opt = document.createElement("option");
  opt.value = method;
  opt.innerText = method;
  methodSelect.appendChild(opt);
});
container.appendChild(methodSelect);

// N√∫t b·∫Øt ƒë·∫ßu
const btn = document.createElement("button");
btn.innerText = "üöÄ B·∫Øt ƒë·∫ßu ki·ªÉm th·ª≠";
btn.style = "margin-top: 15px; padding: 10px; width: 100%; background: #28a745; color: white; border: none; border-radius: 4px; font-size: 16px; cursor: pointer;";
btn.onclick = startTest;
container.appendChild(btn);

// K·∫øt qu·∫£
const resultDiv = document.createElement("div");
resultDiv.style = "margin-top: 20px; padding: 10px; background: #eef; border: 1px solid #aac; min-height: 60px;";
container.appendChild(resultDiv);

// H√†m ki·ªÉm th·ª≠ t·∫£i
function startTest() {
  const url = document.getElementById("url").value;
  const rps = parseInt(document.getElementById("rps").value);
  const duration = parseInt(document.getElementById("duration").value);
  const method = document.getElementById("method").value;

  const total = rps * duration;
  let success = 0;
  let failed = 0;

  resultDiv.innerHTML = "‚è≥ ƒêang g·ª≠i request...";

  for (let i = 0; i < total; i++) {
    setTimeout(() => {
      fetch(url, { method: method })
        .then(res => {
          if (res.ok) success++;
          else failed++;
          updateResult(success, failed, total);
        })
        .catch(() => {
          failed++;
          updateResult(success, failed, total);
        });
    }, (i * 1000) / rps);
  }
}

function updateResult(success, failed, total) {
  resultDiv.innerHTML = `
    ‚úÖ Th√†nh c√¥ng: ${success} <br>
    ‚ùå Th·∫•t b·∫°i: ${failed} <br>
    üîÑ ƒê√£ g·ª≠i: ${success + failed} / ${total}
  `;
}
</script>